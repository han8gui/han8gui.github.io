<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="Han8gui' blog">
<meta property="og:url" content="https://han8gui.github.io/page/4/index.html">
<meta property="og:site_name" content="Han8gui' blog">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Han8gui' blog">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://han8gui.github.io/page/4/"/>





  <title>Han8gui' blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Han8gui' blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description"></h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://han8gui.github.io/2017/07/03/转-理解Javascript中的事件绑定与事件委托/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="怦然心动">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Han8gui' blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/07/03/转-理解Javascript中的事件绑定与事件委托/" itemprop="url">[转]理解Javascript中的事件绑定与事件委托</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-03T15:09:01+08:00">
                2017-07-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="事件绑定"><a href="#事件绑定" class="headerlink" title="事件绑定"></a>事件绑定</h1><h2 id="最直接的事件绑定：HTML事件处理程序"><a href="#最直接的事件绑定：HTML事件处理程序" class="headerlink" title="最直接的事件绑定：HTML事件处理程序"></a>最直接的事件绑定：HTML事件处理程序</h2><p>如下示例代码，通过节点属性显式声明，直接在HTML中，显式地为按钮绑定了click事件，当该按钮有用户点击行为时，便会触发myClickFunc方法。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">/* html */</div><div class="line">&lt;button id=&quot;btn&quot; onclick=&quot;myClickFunc()&quot;&gt;</div><div class="line">    ClickMe</div><div class="line">&lt;/button&gt;</div><div class="line"></div><div class="line">/* js */</div><div class="line">// 事件处理程序</div><div class="line">var myClickFunc = function(evt)&#123;</div><div class="line">    // TODO..</div><div class="line">&#125;;</div><div class="line"></div><div class="line">// 移除事件处理程序</div><div class="line">myClickFunc = function()&#123;&#125;;</div></pre></td></tr></table></figure></p>
<p>显而易见，这种绑定方式非常不友好，HTML代码和JS代码严重耦合在一起，比如当要修改一个函数名时候，就要修改两次，</p>
<h2 id="DOM-0-级事件处理程序"><a href="#DOM-0-级事件处理程序" class="headerlink" title="DOM 0 级事件处理程序"></a>DOM 0 级事件处理程序</h2><p>通过DOM操作动态绑定事件，是一种比较传统的方式，把一个函数赋值给事件处理程序。这种方式也是应用较多的方式，比较简单。看下面例子：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">/* html */</div><div class="line">&lt;button id=&quot;btn&quot;&gt;ClickMe&lt;/button&gt;</div><div class="line"></div><div class="line">/* js */</div><div class="line">// 事件处理程序</div><div class="line">var myClickFunc = function(evt)&#123;</div><div class="line">    // TODO ...</div><div class="line">&#125;;</div><div class="line"></div><div class="line">// 直接给DOM节点的 onclick 方法赋值，注意这里接收的是一个function</div><div class="line">document.getElementById(&apos;btn&apos;).onclick = myClickFunc;</div><div class="line"></div><div class="line">// 移除事件处理程序</div><div class="line">document.getElementById(&apos;btn&apos;).onclick = null;</div></pre></td></tr></table></figure></p>
<h2 id="DOM-2-级事件处理程序"><a href="#DOM-2-级事件处理程序" class="headerlink" title="DOM 2 级事件处理程序"></a>DOM 2 级事件处理程序</h2><p>通过事件监听的方式绑定事件，DOM2级事件定义了两个方法，用于处理指定和删除事件处理程序的操作。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">// event: 事件名称</div><div class="line">// function: 事件函数</div><div class="line">// boolean: false | true, true 为事件捕获, false 为事件冒泡(默认);</div><div class="line">Ele.addEventListener(event,function[,boolean]); // 添加句柄</div><div class="line">ELe.removeEventListener(event,function[,boolean]); // 移除句柄</div><div class="line">看个例子：</div><div class="line"></div><div class="line">/* html */</div><div class="line">&lt;button id=&quot;btn&quot;&gt;ClickMe&lt;/button&gt;</div><div class="line"></div><div class="line">/* js */</div><div class="line">// 通过DOM操作进行动态绑定：</div><div class="line">// 获取btnHello节点</div><div class="line">var oBtn = document.getElementById(&apos;btn&apos;);</div><div class="line"> </div><div class="line">// 增加第一个 click 事件监听处理程序</div><div class="line">oBtn.addEventListener(&apos;click&apos;,function(evt)&#123;</div><div class="line">    // TODO sth 1...</div><div class="line">&#125;);</div><div class="line"> </div><div class="line">// 增加第二个 click 事件监听处理程序</div><div class="line">oBtn.addEventListener(&apos;click&apos;,function(evt)&#123;</div><div class="line">    // TODO sth 2...</div><div class="line">&#125;);</div><div class="line"></div><div class="line">// ps：通过这种形式，可以给btn按钮绑定任意多个click监听；注意，执行顺序与添加顺序相关。</div><div class="line"></div><div class="line">// 移除事件处理程序</div><div class="line">oBtn.removeEventListener(&apos;click&apos;,function(evt)&#123;..&#125;);</div></pre></td></tr></table></figure></p>
<h2 id="IE事件处理程序"><a href="#IE事件处理程序" class="headerlink" title="IE事件处理程序"></a>IE事件处理程序</h2><p>DOM 2级事件处理程序在IE是行不通的，IE有自己的事件处理程序方法：attachEvent()和detachEvent()。这两个方法的用法与addEventListener()是一样的，但是只接收两个参数，一个是事件名称，另一个是事件处理程序的函数。为什么不使用第三个参数的原因呢？因为IE8以及更早的浏览器版本只支持事件冒泡。看个例子：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">/* html */</div><div class="line">&lt;button id=&quot;btn&quot;&gt;ClickMe&lt;/button&gt;</div><div class="line"></div><div class="line">/* js */</div><div class="line">var oBtn = document.getElementById(&apos;btn&apos;);</div><div class="line">// 事件处理函数</div><div class="line">function evtFn()&#123; </div><div class="line">    console.log(this);</div><div class="line">&#125;</div><div class="line">// 添加句柄</div><div class="line">oBtn.attachEvent(&apos;onclick&apos;,evtFn);</div><div class="line"></div><div class="line">// 移除句柄</div><div class="line">oBtn.detachEvent(&apos;onclick&apos;,evtFn);</div></pre></td></tr></table></figure></p>
<p>简易的跨浏览器解决方法<br>如果我们既要支持IE的事件处理方法，又要支持 DOM 2级事件，那么就要封装一个跨浏览器的事件处理函数，如果支持 DOM 2级事件，就用addEventListener，否则就用attachEvent。例子如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">//跨浏览器事件处理程序</div><div class="line">var eventUtil = &#123;</div><div class="line">    // 添加句柄</div><div class="line">    addHandler: function(element, type, handler)&#123;</div><div class="line">        if(element.addEventListener)&#123;</div><div class="line">            element.addEventListener(type, handler, false);</div><div class="line">        &#125;else if(element.attachEvent)&#123;</div><div class="line">            element.attachEvent(&apos;on&apos; + type, handler);</div><div class="line">        &#125;else&#123;</div><div class="line">            element[&apos;on&apos; + type] = handler;</div><div class="line">        &#125;</div><div class="line">    &#125;,</div><div class="line">    // 删除句柄</div><div class="line">    removeHandler: function(element, type, handler)&#123;</div><div class="line">        if(element.removeEventListener)&#123;</div><div class="line">            element.removeEventListener(type, handler, false);</div><div class="line">        &#125;else if(element.detachEvent)&#123;</div><div class="line">            element.detachEvent(&apos;on&apos; + type, handler);</div><div class="line">        &#125;else&#123;</div><div class="line">            element[&apos;on&apos; + type] = null;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">var oBtn = document.getElementById(&apos;btn&apos;);</div><div class="line">function evtFn()&#123;</div><div class="line">    alert(&apos;hello world&apos;);</div><div class="line">&#125;</div><div class="line">eventUtil.addHandler(oBtn, &apos;click&apos;, evtFn);</div><div class="line">eventUtil.removeHandler(oBtn, &apos;click&apos;, evtFn);</div></pre></td></tr></table></figure></p>
<h1 id="事件冒泡和事件捕获"><a href="#事件冒泡和事件捕获" class="headerlink" title="事件冒泡和事件捕获"></a>事件冒泡和事件捕获</h1><p>在了解事件委托之前，要先了解下事件冒泡和事件捕获。</p>
<p>早期的web开发，浏览器厂商很难回答一个哲学上的问题：当你在页面上的一个区域点击时，你真正感兴趣的是哪个元素。这个问题带来了交互的定义。在一个元素的界限内点击，显得有点含糊。毕竟，在一个元素上的点击同时也发生在另一个元素的界限内。例如单击一个按钮。你实际上点击了按钮区域、body元素的区域以及html元素的区域。</p>
<p>伴随着这个问题，两种主流的浏览器Netscape和IE有不同的解决方案。Netscape定义了一种叫做事件捕获的处理方法，事件首先发生在DOM树的最高层对象(document)然后往最深层的元素传播。在图例中，事件捕获首先发生在document上，然后是html元素，body元素，最后是button元素。</p>
<p>IE的处理方法正好相反。他们定义了一种叫事件冒泡的方法。事件冒泡认为事件促发的最深层元素首先接收事件。然后是它的父元素，依次向上，知道document对象最终接收到事件。尽管相对于html元素来说，document没有独立的视觉表现，他仍然是html元素的父元素并且事件能冒泡到document元素。所以图例中噢噢那个button元素先接收事件，然后是body、html最后是document。如下图：<br><img src="http://upload-images.jianshu.io/upload_images/112419-13b59e438dbb6c70.png" alt="图片"></p>
<h2 id="事件冒泡"><a href="#事件冒泡" class="headerlink" title="事件冒泡"></a>事件冒泡</h2><p>简单点说，事件冒泡就是事件触发时，会从目标DOM元素向上传播，直到文档根节点，一般情况下，会是如下形式传播：</p>
<p>targetDOM → parentNode → … → body → document → window</p>
<p>如果希望一次事件触发能在整个DOM树上都得到响应，那么就需要用到事件冒泡的机制。看下面示例：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">/* html */</div><div class="line">&lt;button id=&quot;btn&quot;&gt;ClickMe&lt;/button&gt;</div><div class="line"></div><div class="line">/* js */</div><div class="line">// 给按钮增加click监听</div><div class="line">document.getElementById(&apos;btn&apos;).addEventListener(&apos;click&apos;,function(evt)&#123;</div><div class="line">    alert(&apos;button clicked&apos;);</div><div class="line">&#125;,false);</div><div class="line"> </div><div class="line">// 给body增加click监听</div><div class="line">document.body.addEventListener(&apos;click&apos;,function(evt)&#123;</div><div class="line">    alert(&apos;body clicked&apos;);</div><div class="line">&#125;,false);</div></pre></td></tr></table></figure></p>
<p>在这种情况下，点击按钮“ClickMe”后，其自身的click事件会被触发，同时，该事件将会继续向上传播， 所有的祖先节点都将得到事件的触发命令，并立即触发自己的click事件；所以如上代码，将会连续弹出两个alert.</p>
<p>在有些时候，我们想让事件独立触发，所以我们必须阻止冒泡，用event的stopPropagation()方法。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">&lt;button id=&quot;btn&quot;&gt;ClickMe&lt;/button&gt;</div><div class="line"></div><div class="line">/* js */</div><div class="line">// 给按钮增加click监听</div><div class="line">document.getElementById(&apos;btn&apos;).addEventListener(&apos;click&apos;,function(evt)&#123;</div><div class="line">    alert(&apos;button clicked&apos;);</div><div class="line">    evt.stopPropagation(); //阻止事件冒泡</div><div class="line">&#125;,false);</div><div class="line"> </div><div class="line">// 给body增加click监听</div><div class="line">document.body.addEventListener(&apos;click&apos;,function(evt)&#123;</div><div class="line">    alert(&apos;body clicked&apos;);</div><div class="line">&#125;,false);</div></pre></td></tr></table></figure></p>
<p>此时，点击按钮后，只会触发按钮本身的click事件，得到一个alert效果；该按钮的点击事件，不会向上传播，body节点就接收不到此次事件命令。</p>
<p>需要注意的是：</p>
<p>不是所有的事件都能冒泡，如：blur、focus、load、unload都不能<br>不同的浏览器，阻止冒泡的方式也不一样，在w3c标准中，通过event.stopPropagation()完成， 在IE中则是通过自身的event.cancelBubble=true来完成。</p>
<h1 id="事件委托"><a href="#事件委托" class="headerlink" title="事件委托"></a>事件委托</h1><p>事件委托看起来挺难理解，但是举个生活的例子。比如，有三个同事预计会在周一收到快递。为签收快递，有两种办法：一是三个人在公司门口等快递；二是委托给前台MM代为签收。现实当中，我们大都采用委托的方案（公司也不会容忍那么多员工站在门口就为了等快递）。前台MM收到快递后，她会判断收件人是谁，然后按照收件人的要求签收，甚至代为付款。这种方案还有一个优势，那就是即使公司里来了新员工（不管多少），前台MM也会在收到寄给新员工的快递后核实并代为签收。举个例子</p>
<p>HTML结构：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&lt;ul id=&quot;ul-item&quot;&gt;</div><div class="line">    &lt;li&gt;item1&lt;/li&gt;</div><div class="line">    &lt;li&gt;item2&lt;/li&gt;</div><div class="line">    &lt;li&gt;item3&lt;/li&gt;</div><div class="line">    &lt;li&gt;item4&lt;/li&gt;</div><div class="line">&lt;/ul&gt;</div></pre></td></tr></table></figure></p>
<p>如果我们要点击li标签，弹出里面的内容，我们就需要为每个li标签绑定事件。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">(function()&#123;</div><div class="line">    var oUlItem = document.getElementById(&apos;ul-item&apos;);</div><div class="line">    var oLi = oUlItem.getElementsByTagName(&apos;li&apos;);</div><div class="line">    for(var i=0, l = oLi.length; i &lt; l; i++)&#123;</div><div class="line">        oLi[i].addEventListener(&apos;click&apos;,show);</div><div class="line">    &#125;;</div><div class="line">    function show(e)&#123;</div><div class="line">        e = e || window.event;</div><div class="line">        alert(e.target.innerHTML);</div><div class="line">    &#125;;</div><div class="line">&#125;)();</div></pre></td></tr></table></figure></p>
<p>虽然这样子能够实现我们想要的功能，但是如果这个UL中的LI子元素频繁的添加或删除，我们就需要在每次添加LI的时候为它绑定事件。这就添加了复杂度，并且造成内存开销较大。</p>
<p>更简单的方法是利用事件委托，当事件被掏到更上层的父节点的时候，通过检查事件的目标对象（target）来判断并获取事件源LI。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">(function()&#123;</div><div class="line">    var oUlItem = document.getElementById(&apos;ul-item&apos;);</div><div class="line">    oUlItem.addEventListener(&apos;click&apos;,show);</div><div class="line">    function show(e)&#123;</div><div class="line">        e = e || window.event;</div><div class="line">        var src = e.target;</div><div class="line">        if(src &amp;&amp; src.nodeName.toLowerCase() === &apos;li&apos;)&#123;</div><div class="line">            alert(src.innerHTML);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;)();</div></pre></td></tr></table></figure></p>
<p>这里我们为父节点UL添加了点击事件，当点击子节点LI标签的时候，点击事件会冒泡到父节点。父节点捕获到事件之后，通过判断e.target.nodeName来判断是否为我们需要处理的节点，并且通过e.target拿到了被点击的Li节点。从而可以获取到相应的信息，并做处理。</p>
<p>优点：</p>
<p>通过上面的介绍，大家应该能够体会到使用事件委托对于web应用程序带来的几个优点：</p>
<p>管理的函数变少了。不需要为每个元素都添加监听函数。对于同一个父节点下面类似的子元素，可以通过委托给父元素的监听函数来处理事件。<br>可以方便地动态添加和修改元素，不需要因为元素的改动而修改事件绑定。<br>JavaScript和DOM节点之间的关联变少了，这样也就减少了因循环引用而带来的内存泄漏发生的概率。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://han8gui.github.io/2017/06/29/CentOS设置服务开机启动的方法/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="怦然心动">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Han8gui' blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/29/CentOS设置服务开机启动的方法/" itemprop="url">CentOS设置服务开机启动的方法</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-29T09:37:15+08:00">
                2017-06-29
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="方法一：利用-chkconfig-来配置启动级别"><a href="#方法一：利用-chkconfig-来配置启动级别" class="headerlink" title="方法一：利用 chkconfig 来配置启动级别"></a>方法一：利用 chkconfig 来配置启动级别</h1><pre><code>在CentOS或者RedHat其他系统下，如果是后面安装的服务，如httpd、mysqld、postfix等，安装后系统默认不会自动启动的。就算手动执行 /etc/init.d/mysqld start 启动了服务，只要服务器重启后，系统仍然不会自动启动服务。 在这个时候，我们就需要在安装后做个设置，让系统自动启动这些服务，避免不必要的损失和麻烦。 其实命令很简单的，使用chkconfig即可。
</code></pre><h2 id="chkconfig介绍"><a href="#chkconfig介绍" class="headerlink" title="chkconfig介绍"></a>chkconfig介绍</h2><p><strong>简介</strong><br>chkconfig命令检查、设置系统的各种服务。这是Red Hat公司遵循GPL规则所开发的程序，它可查询操作系统在每一个执行等级中会执行哪些系统服务，其中包括各类常驻服务。谨记chkconfig不是立即自动禁止或激活一个服务，它只是简单的改变了符号连接。</p>
<p><strong>语法</strong><br>–add：增加所指定的系统服务，让chkconfig指令得以管理它，并同时在系统启动的叙述文件内增加相关数据； –del：删除所指定的系统服务，不再由chkconfig指令管理，并同时在系统启动的叙述文件内删除相关数据； –level&lt;等级代号&gt;：指定读系统服务要在哪一个执行等级中开启或关毕。</p>
<p>等级代号列表：<br>等级0表示：表示关机<br>等级1表示：单用户模式<br>等级2表示：无网络连接的多用户命令行模式 等级3表示：有网络连接的多用户命令行模式<br>等级4表示：不可用 等级5表示：带图形界面的多用户模式<br>等级6表示：重新启动</p>
<h2 id="systemctl命令"><a href="#systemctl命令" class="headerlink" title="systemctl命令"></a>systemctl命令</h2><p>systemctl命令是系统服务管理器指令，它实际上将 service 和 chkconfig 这两个命令组合到一起。有时候你执行chkconfig命令无效，需要执行systemctl命令。</p>
<p><strong>语法</strong></p>
<p><img src="http://img.blog.csdn.net/20170629093302415?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvVGltZTg4OA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="语法"></p>
<h1 id="方法二：修改-etc-rc-d-rc-local-这个文件"><a href="#方法二：修改-etc-rc-d-rc-local-这个文件" class="headerlink" title="方法二：修改 /etc/rc.d/rc.local 这个文件"></a>方法二：修改 /etc/rc.d/rc.local 这个文件</h1><p>vi /etc/rc.d/rc.local<br>例如将 apache、mysql、samba、svn 等这些服务的开机自启动问题一起搞定：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">#添加以下命令</div><div class="line">/usr/sbin/apachectl start</div><div class="line">/etc/rc.d/init.d/mysqld start</div><div class="line">/etc/rc.d/init.d/smb start</div><div class="line">/usr/local/subversion/bin/svnserve -d</div></pre></td></tr></table></figure></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://han8gui.github.io/2017/06/26/常用分析日志shell命令/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="怦然心动">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Han8gui' blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/26/常用分析日志shell命令/" itemprop="url">常用分析日志shell命令</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-26T17:44:49+08:00">
                2017-06-26
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>1、查看有多少个IP访问：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">awk &apos;&#123;print $1&#125;&apos; log_file|sort|uniq|wc -l</div></pre></td></tr></table></figure></p>
<p>2、查看某一个页面被访问的次数：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">grep &quot;/index.php&quot; log_file | wc -l</div><div class="line"></div><div class="line">3、查看每一个IP访问了多少个页面：</div><div class="line"></div><div class="line">awk &apos;&#123;++S[$1]&#125; END &#123;for (a in S) print a,S[a]&#125;&apos; log_file &gt; log.txt</div><div class="line"></div><div class="line">sort -n -t &apos; &apos; -k 2 log.txt 配合sort进一步排序</div></pre></td></tr></table></figure></p>
<p>4、将每个IP访问的页面数进行从小到大排序：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">awk &apos;&#123;++S[$1]&#125; END &#123;for (a in S) print S[a],a&#125;&apos; log_file | sort -n</div></pre></td></tr></table></figure></p>
<p>5、查看某一个IP访问了哪些页面：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">grep ^111.111.111.111 log_file| awk &apos;&#123;print $1,$7&#125;&apos;</div></pre></td></tr></table></figure></p>
<p>6、去掉搜索引擎统计的页面：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">awk &apos;&#123;print $12,$1&#125;&apos; log_file | grep ^\&quot;Mozilla | awk &apos;&#123;print $2&#125;&apos; |sort | uniq | wc -l</div></pre></td></tr></table></figure></p>
<p>7、查看2015年8月16日14时这一个小时内有多少IP访问:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">awk &apos;&#123;print $4,$1&#125;&apos; log_file | grep 16/Aug/2015:14 | awk &apos;&#123;print $2&#125;&apos;| sort | uniq | wc -l</div></pre></td></tr></table></figure></p>
<p>8、查看访问前十个ip地址<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">awk &apos;&#123;print $1&#125;&apos; |sort|uniq -c|sort -nr |head -10 access_log</div><div class="line"></div><div class="line">uniq -c 相当于分组统计并把统计数放在最前面</div><div class="line">cat access.log|awk &apos;&#123;print $1&#125;&apos;|sort|uniq -c|sort -nr|head -10</div><div class="line"></div><div class="line">cat access.log|awk &apos;&#123;counts[$(11)]+=1&#125;; END &#123;for(url in counts) print counts[url], url&#125;</div></pre></td></tr></table></figure></p>
<p>9、访问次数最多的10个文件或页面<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">cat log_file|awk &apos;&#123;print $11&#125;&apos;|sort|uniq -c|sort -nr | head -10</div><div class="line"></div><div class="line">cat log_file|awk &apos;&#123;print $11&#125;&apos;|sort|uniq -c|sort -nr|head -20</div><div class="line"></div><div class="line">awk &apos;&#123;print $1&#125;&apos; log_file |sort -n -r |uniq -c | sort -n -r | head -20 </div><div class="line">访问量最大的前20个ip</div></pre></td></tr></table></figure></p>
<p>10、通过子域名访问次数，依据referer来计算，稍有不准<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cat access.log | awk &apos;&#123;print $11&#125;&apos; | sed -e &apos; s/http:\/\///&apos; -e &apos; s/\/.*//&apos; | sort | uniq -c | sort -rn | head -20</div></pre></td></tr></table></figure></p>
<p>11、列出传输大小最大的几个文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cat www.access.log |awk &apos;($7~/\.php/)&#123;print $10 &quot; &quot; $1 &quot; &quot; $4 &quot; &quot; $7&#125;&apos;|sort -nr|head -100</div></pre></td></tr></table></figure></p>
<p>12、列出输出大于200000byte(约200kb)的页面以及对应页面发生次数<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cat www.access.log |awk &apos;($10 &gt; 200000 &amp;&amp; $7~/\.php/)&#123;print $7&#125;&apos;|sort -n|uniq -c|sort -nr|head -100</div></pre></td></tr></table></figure></p>
<p>13、如果日志最后一列记录的是页面文件传输时间，则有列出到客户端最耗时的页面<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cat www.access.log |awk &apos;($7~/\.php/)&#123;print $NF &quot; &quot; $1 &quot; &quot; $4 &quot; &quot; $7&#125;&apos;|sort -nr|head -100</div></pre></td></tr></table></figure></p>
<p>14、列出最最耗时的页面(超过60秒的)的以及对应页面发生次数<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cat www.access.log |awk &apos;($NF &gt; 60 &amp;&amp; $7~/\.php/)&#123;print $7&#125;&apos;|sort -n|uniq -c|sort -nr|head -100</div></pre></td></tr></table></figure></p>
<p>15、列出传输时间超过 30 秒的文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cat www.access.log |awk &apos;($NF &gt; 30)&#123;print $7&#125;&apos;|sort -n|uniq -c|sort -nr|head -20</div></pre></td></tr></table></figure></p>
<p>16、列出当前服务器每一进程运行的数量，倒序排列<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ps -ef | awk -F &apos; &apos; &apos;&#123;print $8 &quot; &quot; $9&#125;&apos; |sort | uniq -c |sort -nr |head -20</div></pre></td></tr></table></figure></p>
<p>17、查看apache当前并发访问数<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">对比httpd.conf中MaxClients的数字差距多少</div><div class="line">netstat -an | grep ESTABLISHED | wc -l</div></pre></td></tr></table></figure></p>
<p>18、可以使用如下参数查看数据<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">ps -ef|grep httpd|wc -l</div><div class="line"></div><div class="line">1388</div><div class="line">统计httpd进程数，连个请求会启动一个进程，使用于Apache服务器。</div><div class="line">表示Apache能够处理1388个并发请求，这个值Apache可根据负载情况自动调整</div><div class="line"></div><div class="line">netstat -nat|grep -i &quot;80&quot;|wc -l</div><div class="line"></div><div class="line">4341</div><div class="line">netstat -an会打印系统当前网络链接状态，而grep -i &quot;80&quot;是用来提取与80端口有关的连接的，wc -l进行连接数统计。</div><div class="line">最终返回的数字就是当前所有80端口的请求总数</div><div class="line"></div><div class="line">netstat -na|grep ESTABLISHED|wc -l</div><div class="line"></div><div class="line">376</div><div class="line">netstat -an会打印系统当前网络链接状态，而grep ESTABLISHED 提取出已建立连接的信息。 然后wc -l统计</div><div class="line">最终返回的数字就是当前所有80端口的已建立连接的总数。</div><div class="line"></div><div class="line">netstat -nat||grep ESTABLISHED|wc</div><div class="line"></div><div class="line">可查看所有建立连接的详细记录</div></pre></td></tr></table></figure></p>
<p>19、输出每个ip的连接数，以及总的各个状态的连接数<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">netstat -n | awk &apos;/^tcp/ &#123;n=split($(NF-1),array,&quot;:&quot;);if(n&lt;=2)++S[array[(1)]];else++S[array[(4)]];++s[$NF];++N&#125; END &#123;for(a in S)&#123;printf(&quot;%-20s %s\n&quot;, a, S[a]);++I&#125;printf(&quot;%-20s %s\n&quot;,&quot;TOTAL_IP&quot;,I);for(a in s) printf(&quot;%-20s %s\n&quot;,a, s[a]);printf(&quot;%-20s %s\n&quot;,&quot;TOTAL_LINK&quot;,N);&#125;&apos;</div></pre></td></tr></table></figure></p>
<p>20、其他的收集</p>
<p>分析日志文件下 2012-05-04 访问页面最高 的前20个 URL 并排序<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cat access.log |grep &apos;04/May/2012&apos;| awk &apos;&#123;print $11&#125;&apos;|sort|uniq -c|sort -nr|head -20</div></pre></td></tr></table></figure></p>
<p>查询受访问页面的URL地址中 含有 www.abc.com 网址的 IP 地址<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cat access_log | awk &apos;($11~/\www.abc.com/)&#123;print $1&#125;&apos;|sort|uniq -c|sort -nr</div></pre></td></tr></table></figure></p>
<p>获取访问最高的10个IP地址 同时也可以按时间来查询<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cat linewow-access.log|awk &apos;&#123;print $1&#125;&apos;|sort|uniq -c|sort -nr|head -10</div></pre></td></tr></table></figure></p>
<p>时间段查询日志时间段的情况<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cat log_file | egrep &apos;15/Aug/2015|16/Aug/2015&apos; |awk &apos;&#123;print $1&#125;&apos;|sort|uniq -c|sort -nr|head -10</div></pre></td></tr></table></figure></p>
<p>分析2015/8/15 到 2015/8/16 访问”<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">```</div><div class="line">cat log_file | egrep &apos;15/Aug/2015|16/Aug/2015&apos; | awk &apos;&#123;if($7 == &quot;/index.php?g=Member&amp;m=Public&amp;a=sendValidCode&quot;) print $1,$7&#125;&apos;|sort|uniq -c|sort -nr</div><div class="line"></div><div class="line">($7~/.php/) $7里面包含.php的就输出,本句的意思是最耗时的一百个PHP页面</div><div class="line"></div><div class="line">cat log_file |awk &apos;($7~/\.php/)&#123;print $NF &quot; &quot; $1 &quot; &quot; $4 &quot; &quot; $7&#125;&apos;|sort -nr|head -100</div></pre></td></tr></table></figure></p>
<p>列出最最耗时的页面(超过60秒的)的以及对应页面发生次数<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cat access.log |awk &apos;($NF &gt; 60 &amp;&amp; $7~/\.php/)&#123;print $7&#125;&apos;|sort -n|uniq -c|sort -nr|head -100</div></pre></td></tr></table></figure></p>
<p>统计网站流量（G)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cat access.log |awk &apos;&#123;sum+=$10&#125; END &#123;print sum/1024/1024/1024&#125;&apos;</div></pre></td></tr></table></figure></p>
<p>统计404的连接<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">awk &apos;($9 ~/404/)&apos; access.log | awk &apos;&#123;print $9,$7&#125;&apos; | sort</div></pre></td></tr></table></figure></p>
<p>统计http status<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">cat access.log |awk &apos;&#123;counts[$(9)]+=1&#125;; END &#123;for(code in counts) print code, counts[code]&#125;&apos; </div><div class="line">cat access.log |awk &apos;&#123;print $9&#125;&apos;|sort|uniq -c|sort -rn</div></pre></td></tr></table></figure></p>
<p>每秒并发<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">watch &quot;awk &apos;&#123;if($9~/200|30|404/)COUNT[$4]++&#125;END&#123;for( a in COUNT) print a,COUNT[a]&#125;&apos; log_file|sort -k 2 -nr|head -n10&quot;</div></pre></td></tr></table></figure></p>
<p>带宽统计<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">cat apache.log |awk &apos;&#123;if($7~/GET/) count++&#125;END&#123;print &quot;client_request=&quot;count&#125;&apos; </div><div class="line">cat apache.log |awk &apos;&#123;BYTE+=$11&#125;END&#123;print &quot;client_kbyte_out=&quot;BYTE/1024&quot;KB&quot;&#125;&apos;</div></pre></td></tr></table></figure></p>
<p>找出某天访问次数最多的10个IP<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cat /tmp/access.log | grep &quot;20/Mar/2011&quot; |awk &apos;&#123;print $3&#125;&apos;|sort |uniq -c|sort -nr|head</div></pre></td></tr></table></figure></p>
<p>当天ip连接数最高的ip都在干些什么<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cat access.log | grep &quot;10.0.21.17&quot; | awk &apos;&#123;print $8&#125;&apos; | sort | uniq -c | sort -nr | head -n 10</div></pre></td></tr></table></figure></p>
<p>小时单位里ip连接数最多的10个时段<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">awk -vFS=&quot;[:]&quot; &apos;&#123;gsub(&quot;-.*&quot;,&quot;&quot;,$1);num[$2&quot; &quot;$1]++&#125;END&#123;for(i in num)print i,num[i]&#125;&apos; log_file | sort -n -k 3 -r | head -10</div></pre></td></tr></table></figure></p>
<p>找出访问次数最多的几个分钟<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">awk &apos;&#123;print $1&#125;&apos; access.log | grep &quot;20/Mar/2011&quot; |cut -c 14-18|sort|uniq -c|sort -nr|head</div><div class="line">取5分钟日志</div><div class="line">if [ $DATE_MINUTE != $DATE_END_MINUTE ] ;then #则判断开始时间戳与结束时间戳是否相等</div><div class="line">START_LINE=sed -n &quot;/$DATE_MINUTE/=&quot; $APACHE_LOG|head -n1 #如果不相等，则取出开始时间戳的行号，与结束时间戳的行号</div></pre></td></tr></table></figure></p>
<p>查看tcp的链接状态<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line">netstat -nat |awk &apos;&#123;print $6&#125;&apos;|sort|uniq -c|sort -rn </div><div class="line">    </div><div class="line">netstat -n | awk &apos;/^tcp/ &#123;++S[$NF]&#125;;END &#123;for(a in S) print a, S[a]&#125;&apos; </div><div class="line"></div><div class="line">netstat -n | awk &apos;/^tcp/ &#123;++state[$NF]&#125;; END &#123;for(key in state) print key,&quot;\t&quot;,state[key]&#125;&apos; </div><div class="line">    </div><div class="line">netstat -n | awk &apos;/^tcp/ &#123;++arr[$NF]&#125;;END &#123;for(k in arr) print k,&quot;\t&quot;,arr[k]&#125;&apos; </div><div class="line">    </div><div class="line">netstat -n |awk &apos;/^tcp/ &#123;print $NF&#125;&apos;|sort|uniq -c|sort -rn </div><div class="line">    </div><div class="line">netstat -ant | awk &apos;&#123;print $NF&#125;&apos; | grep -v &apos;[a-z]&apos; | sort | uniq -c</div><div class="line">netstat -ant|awk &apos;/ip:80/&#123;split($5,ip,&quot;:&quot;);++S[ip[1]]&#125;END&#123;for (a in S) print S[a],a&#125;&apos; |sort -n </div><div class="line">    </div><div class="line">netstat -ant|awk &apos;/:80/&#123;split($5,ip,&quot;:&quot;);++S[ip[1]]&#125;END&#123;for (a in S) print S[a],a&#125;&apos; |sort -rn|head -n 10 </div><div class="line">    </div><div class="line">awk &apos;BEGIN&#123;printf (&quot;http_code\tcount_num\n&quot;)&#125;&#123;COUNT[$10]++&#125;END&#123;for (a in COUNT) printf a&quot;\t\t&quot;COUNT[a]&quot;\n&quot;&#125;&apos;</div><div class="line">查找请求数前20个IP（常用于查找攻来源）： </div><div class="line">netstat -anlp|grep 80|grep tcp|awk &apos;&#123;print $5&#125;&apos;|awk -F: &apos;&#123;print $1&#125;&apos;|sort|uniq -c|sort -nr|head -n20 </div><div class="line">netstat -ant |awk &apos;/:80/&#123;split($5,ip,&quot;:&quot;);++A[ip[1]]&#125;END&#123;for(i in A) print A[i],i&#125;&apos; |sort -rn|head -n20</div><div class="line"></div><div class="line">用tcpdump嗅探80端口的访问看看谁最高</div><div class="line"></div><div class="line">tcpdump -i eth0 -tnn dst port 80 -c 1000 | awk -F&quot;.&quot; &apos;&#123;print $1&quot;.&quot;$2&quot;.&quot;$3&quot;.&quot;$4&#125;&apos; | sort | uniq -c | sort -nr |head -20</div><div class="line"></div><div class="line">查找较多time_wait连接</div><div class="line"></div><div class="line">netstat -n|grep TIME_WAIT|awk &apos;&#123;print $5&#125;&apos;|sort|uniq -c|sort -rn|head -n20</div><div class="line"></div><div class="line">找查较多的SYN连接</div><div class="line"></div><div class="line">netstat -an | grep SYN | awk &apos;&#123;print $5&#125;&apos; | awk -F: &apos;&#123;print $1&#125;&apos; | sort | uniq -c | sort -nr | more</div><div class="line"></div><div class="line">根据端口列进程 </div><div class="line">netstat -ntlp | grep 80 | awk &apos;&#123;print $7&#125;&apos; | cut -d/ -f1</div><div class="line"></div><div class="line">查看了连接数和当前的连接数</div><div class="line"></div><div class="line">netstat -ant | grep $ip:80 | wc -l </div><div class="line">netstat -ant | grep $ip:80 | grep EST | wc -l</div><div class="line"></div><div class="line">查看IP访问次数 </div><div class="line">netstat -nat|grep &quot;:80&quot;|awk &apos;&#123;print $5&#125;&apos; |awk -F: &apos;&#123;print $1&#125;&apos; | sort| uniq -c|sort -n</div><div class="line"></div><div class="line">Linux命令分析当前的链接状况</div><div class="line">netstat -n | awk &apos;/^tcp/ &#123;++S[$NF]&#125; END &#123;for(a in S) print a, S[a]&#125;&apos;</div><div class="line"></div><div class="line">watch &quot;netstat -n | awk &apos;/^tcp/ &#123;++S[\$NF]&#125; END &#123;for(a in S) print a, S[a]&#125;&apos;&quot; # 通过watch可以一直监控</div></pre></td></tr></table></figure></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://han8gui.github.io/2017/06/23/一个逻辑的上的问题/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="怦然心动">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Han8gui' blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/23/一个逻辑的上的问题/" itemprop="url">一个逻辑的上的问题</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-23T18:08:48+08:00">
                2017-06-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="问题场景："><a href="#问题场景：" class="headerlink" title="问题场景："></a>问题场景：</h2><p>调用一个api执行sql,返回执行成功。<br>如：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">执行前结果：</div><div class="line">table</div><div class="line">id  test    dated</div><div class="line">1    0     2017-06-22</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">执行的sql: update table set `test` = 1 and `dated` = &apos;2017-06-23&apos; where `id` =1 limit 1</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">执行后结果：</div><div class="line">id  test    dated</div><div class="line">1    0     2017-06-23</div></pre></td></tr></table></figure>
<p>如果手动执行sql:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">执行后结果：</div><div class="line">id  test    dated</div><div class="line">1    1     2017-06-23</div></pre></td></tr></table></figure></p>
<h2 id="问题排查"><a href="#问题排查" class="headerlink" title="问题排查"></a>问题排查</h2><ol>
<li>查binlog<br>sql是正常执行的</li>
</ol>
<p>2.发现执行sql的同时，执行了另一条sql<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">update table set `test` = 0 where `id` =1 limit 1</div></pre></td></tr></table></figure></p>
<p>执行的原因是：因为消息系统。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>推理过程：A =&gt; B =&gt; C<br>我们经常看到从A =&gt; C的过程，感觉很纳闷。<br>其实过程中，B常常是被忽略的，所以需要着重注意一下。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://han8gui.github.io/2017/06/23/Redis-和-Memcached-的区别/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="怦然心动">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Han8gui' blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/23/Redis-和-Memcached-的区别/" itemprop="url">Redis 和 Memcached 的区别</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-23T00:07:51+08:00">
                2017-06-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="一、基本描述"><a href="#一、基本描述" class="headerlink" title="一、基本描述"></a>一、基本描述</h2><p>redis与memcached相比，比仅支持简单的key-value数据类型，同时还提供list,set,zset,hash等数据结构的存储；<br>redis支持数据的备份，即master-slave模式的数据备份；<br>redis支持数据的持久化，可以将内存中的数据保持在磁盘中，重启的时候可以再次加载进行使用等等，</p>
<h2 id="二、网络IO模型"><a href="#二、网络IO模型" class="headerlink" title="二、网络IO模型"></a>二、网络IO模型</h2><p>memcached是多线程，非阻塞IO复用的网络模型，分为监听主线程和worker子线程，监听线程监听网络连接，接受请求后，将连接描述字pipe传递给worker线程，进行读写IO，网络层使用libevent封装的事件库，多线程模型可以发挥多核作用，但是引入了cache coherency和锁的问题，比如：memcached最常用的stats命令，实际memcached所有操作都要对这个全局变量加锁，进行技术等工作，带来了性能损耗。</p>
<p>redis使用单线程的IO复用模型，自己封装了一个简单的AeEvent事件处理框架，主要实现了epoll, kqueue和select，对于单存只有IO操作来说，单线程可以将速度优势发挥到最大，但是redis也提供了一些简单的计算功能，比如排序、聚合等，对于这些操作，单线程模型施加会严重影响整体吞吐量，CPU计算过程中，整个IO调度都是被阻塞的。</p>
<h2 id="三、数据支持类型"><a href="#三、数据支持类型" class="headerlink" title="三、数据支持类型"></a>三、数据支持类型</h2><p>memcached使用key-value形式存储和访问数据，在内存中维护一张巨大的HashTable，使得对数据查询的时间复杂度降低到O(1)，保证了对数据的高性能访问。</p>
<p>正如开篇所说：redis与memcached相比，比仅支持简单的key-value数据类型，同时还提供list,set,zset,hash等数据结构的存储；</p>
<p>内存管理机制</p>
<p>对于像Redis和Memcached这种基于内存的数据库系统来说，内存管理的效率高低是影响系统性能的关键因素。传统C语言中的malloc/free函数是最常用的分配和释放内存的方法，但是这种方法存在着很大的缺陷：首先，对于开发人员来说不匹配的malloc和free容易造成内存泄露；其次频繁调用会造成大量内存碎片无法回收重新利用，降低内存利用率；最后作为系统调用，其系统开销远远大于一般函数调用。所以，为了提高内存的管理效率，高效的内存管理方案都不会直接使用malloc/free调用。Redis和Memcached均使用了自身设计的内存管理机制，但是实现方法存在很大的差异，下面将会对两者的内存管理机制分别进行介绍。</p>
<p>Memcached默认使用Slab Allocation机制管理内存，其主要思想是按照预先规定的大小，将分配的内存分割成特定长度的块以存储相应长度的key-value数据记录，以完全解决内存碎片问题。Slab Allocation机制只为存储外部数据而设计，也就是说所有的key-value数据都存储在Slab Allocation系统里，而Memcached的其它内存请求则通过普通的malloc/free来申请，因为这些请求的数量和频率决定了它们不会对整个系统的性能造成影响Slab Allocation的原理相当简单。 如图所示，它首先从操作系统申请一大块内存，并将其分割成各种尺寸的块Chunk，并把尺寸相同的块分成组Slab Class。其中，Chunk就是用来存储key-value数据的最小单位。每个Slab Class的大小，可以在Memcached启动的时候通过制定Growth Factor来控制。假定图中Growth Factor的取值为1.25，如果第一组Chunk的大小为88个字节，第二组Chunk的大小就为112个字节，依此类推。</p>
<p><img src="http://img.blog.csdn.net/20160413201307553" alt=""></p>
<p>当Memcached接收到客户端发送过来的数据时首先会根据收到数据的大小选择一个最合适的Slab Class，然后通过查询Memcached保存着的该Slab Class内空闲Chunk的列表就可以找到一个可用于存储数据的Chunk。当一条数据库过期或者丢弃时，该记录所占用的Chunk就可以回收，重新添加到空闲列表中。从以上过程我们可以看出Memcached的内存管理制效率高，而且不会造成内存碎片，但是它最大的缺点就是会导致空间浪费。因为每个Chunk都分配了特定长度的内存空间，所以变长数据无法充分利用这些空间。如图 所示，将100个字节的数据缓存到128个字节的Chunk中，剩余的28个字节就浪费掉了。</p>
<p><img src="http://img.blog.csdn.net/20160413201331287" alt=""></p>
<p>Redis的内存管理主要通过源码中zmalloc.h和zmalloc.c两个文件来实现的。Redis为了方便内存的管理，在分配一块内存之后，会将这块内存的大小存入内存块的头部。如图所示，real_ptr是redis调用malloc后返回的指针。redis将内存块的大小size存入头部，size所占据的内存大小是已知的，为size_t类型的长度，然后返回ret_ptr。当需要释放内存的时候，ret_ptr被传给内存管理程序。通过ret_ptr，程序可以很容易的算出real_ptr的值，然后将real_ptr传给free释放内存。</p>
<p><img src="http://img.blog.csdn.net/20160413201348490" alt=""></p>
<p>Redis通过定义一个数组来记录所有的内存分配情况，这个数组的长度为ZMALLOC_MAX_ALLOC_STAT。数组的每一个元素代表当前程序所分配的内存块的个数，且内存块的大小为该元素的下标。在源码中，这个数组为zmalloc_allocations。zmalloc_allocations[16]代表已经分配的长度为16bytes的内存块的个数。zmalloc.c中有一个静态变量used_memory用来记录当前分配的内存总大小。所以，总的来看，Redis采用的是包装的mallc/free，相较于Memcached的内存管理方法来说，要简单很多。</p>
<p>在Redis中，并不是所有的数据都一直存储在内存中的。这是和Memcached相比一个最大的区别。当物理内存用完时，Redis可以将一些很久没用到的value交换到磁盘。Redis只会缓存所有的key的信息，如果Redis发现内存的使用量超过了某一个阀值，将触发swap的操作，Redis根据“swappability = age*log(size_in_memory)”计算出哪些key对应的value需要swap到磁盘。然后再将这些key对应的value持久化到磁盘中，同时在内存中清除。这种特性使得Redis可以保持超过其机器本身内存大小的数据。当然，机器本身的内存必须要能够保持所有的key，毕竟这些数据是不会进行swap操作的。同时由于Redis将内存中的数据swap到磁盘中的时候，提供服务的主线程和进行swap操作的子线程会共享这部分内存，所以如果更新需要swap的数据，Redis将阻塞这个操作，直到子线程完成swap操作后才可以进行修改。当从Redis中读取数据的时候，如果读取的key对应的value不在内存中，那么Redis就需要从swap文件中加载相应数据，然后再返回给请求方。 这里就存在一个I/O线程池的问题。在默认的情况下，Redis会出现阻塞，即完成所有的swap文件加载后才会相应。这种策略在客户端的数量较小，进行批量操作的时候比较合适。但是如果将Redis应用在一个大型的网站应用程序中，这显然是无法满足大并发的情况的。所以Redis运行我们设置I/O线程池的大小，对需要从swap文件中加载相应数据的读取请求进行并发操作，减少阻塞的时间。</p>
<p>Memcached使用预分配的内存池的方式，使用slab和大小不同的chunk来管理内存，Item根据大小选择合适的chunk存储，内存池的方式可以省去申请/释放内存的开销，并且能减小内存碎片产生，但这种方式也会带来一定程度上的空间浪费，并且在内存仍然有很大空间时，新的数据也可能会被剔除，原因可以参考Timyang的文章：<a href="http://timyang.net/data/Memcached-lru-evictions/" target="_blank" rel="external">http://timyang.net/data/Memcached-lru-evictions/</a></p>
<p>Redis使用现场申请内存的方式来存储数据，并且很少使用free-list等方式来优化内存分配，会在一定程度上存在内存碎片，Redis跟据存储命令参数，会把带过期时间的数据单独存放在一起，并把它们称为临时数据，非临时数据是永远不会被剔除的，即便物理内存不够，导致swap也不会剔除任何非临时数据（但会尝试剔除部分临时数据），这点上Redis更适合作为存储而不是cache。</p>
<h2 id="五、数据存储及持久化"><a href="#五、数据存储及持久化" class="headerlink" title="五、数据存储及持久化"></a>五、数据存储及持久化</h2><p>memcached不支持内存数据的持久化操作，所有的数据都以in-memory的形式存储。</p>
<p>redis支持持久化操作。redis提供了两种不同的持久化方法来讲数据存储到硬盘里面，一种是快照（snapshotting)，它可以将存在于某一时刻的所有数据都写入硬盘里面。另一种方法叫只追加文件（append-only file， AOF),它会在执行写命令时，将被执行的写命令复制到硬盘里面。</p>
<h2 id="六、数据一致性问题"><a href="#六、数据一致性问题" class="headerlink" title="六、数据一致性问题"></a>六、数据一致性问题</h2><p>Memcached提供了cas命令，可以保证多个并发访问操作同一份数据的一致性问题。 Redis没有提供cas 命令，并不能保证这点，不过Redis提供了事务的功能，可以保证一串 命令的原子性，中间不会被任何操作打断。</p>
<h2 id="七、集群管理不同"><a href="#七、集群管理不同" class="headerlink" title="七、集群管理不同"></a>七、集群管理不同</h2><p>Memcached是全内存的数据缓冲系统，Redis虽然支持数据的持久化，但是全内存毕竟才是其高性能的本质。作为基于内存的存储系统来说，机器物理内存的大小就是系统能够容纳的最大数据量。如果需要处理的数据量超过了单台机器的物理内存大小，就需要构建分布式集群来扩展存储能力。</p>
<p>Memcached本身并不支持分布式，因此只能在客户端通过像一致性哈希这样的分布式算法来实现Memcached的分布式存储。下图给出了Memcached的分布式存储实现架构。当客户端向Memcached集群发送数据之前，首先会通过内置的分布式算法计算出该条数据的目标节点，然后数据会直接发送到该节点上存储。但客户端查询数据时，同样要计算出查询数据所在的节点，然后直接向该节点发送查询请求以获取数据。</p>
<p>相较于Memcached只能采用客户端实现分布式存储，Redis更偏向于在服务器端构建分布式存储。最新版本的Redis已经支持了分布式存储功能。Redis Cluster是一个实现了分布式且允许单点故障的Redis高级版本，它没有中心节点，具有线性可伸缩的功能。Redis Cluster的分布式存储架构，节点与节点之间通过二进制协议进行通信，节点与客户端之间通过ascii协议进行通信。在数据的放置策略上，Redis Cluster将整个key的数值域分成4096个哈希槽，每个节点上可以存储一个或多个哈希槽，也就是说当前Redis Cluster支持的最大节点数就是4096。Redis Cluster使用的分布式算法也很简单：crc16( key ) % HASH_SLOTS_NUMBER。</p>
<p>为了保证单点故障下的数据可用性，Redis Cluster引入了Master节点和Slave节点。在Redis Cluster中，每个Master节点都会有对应的两个用于冗余的Slave节点。这样在整个集群中，任意两个节点的宕机都不会导致数据的不可用。当Master节点退出后，集群会自动选择一个Slave节点成为新的Master节点。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://han8gui.github.io/2017/06/22/CI框架中调整sql查询条件关系/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="怦然心动">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Han8gui' blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/22/CI框架中调整sql查询条件关系/" itemprop="url">CI框架中调整sql查询条件关系</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-22T00:07:16+08:00">
                2017-06-22
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="问题说明："><a href="#问题说明：" class="headerlink" title="问题说明："></a>问题说明：</h2><p>sql执行的时候，查询条件并没有优先级，需要调整下。</p>
<h2 id="想实现的场景"><a href="#想实现的场景" class="headerlink" title="想实现的场景"></a>想实现的场景</h2><p>sql查询条件: A and B and (C or D)</p>
<h2 id="示例代码"><a href="#示例代码" class="headerlink" title="示例代码"></a>示例代码</h2><p>想获取18岁，姓名为A或B的人。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">$this-&gt;db-&gt;select(&apos;id&apos;)</div><div class="line">	-&gt;where(&apos;age&apos;,18) </div><div class="line">	-&gt;group_start() //左括号</div><div class="line">	-&gt;like(&apos;name&apos;, &apos;B&apos;)</div><div class="line">	-&gt;or_like(&apos;name&apos;, &apos;C&apos;)</div><div class="line">	-&gt;group_end() //右括号</div><div class="line">	-&gt;get(&apos;table&apos;);</div></pre></td></tr></table></figure></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://han8gui.github.io/2017/06/14/转-ios-绑定事件无效/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="怦然心动">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Han8gui' blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/14/转-ios-绑定事件无效/" itemprop="url">[转]ios 绑定事件无效</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-14T11:27:42+08:00">
                2017-06-14
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h2><p>当使用委托给一个元素添加click事件时，如果事件是委托到 document 或 body 上，并且委托的元素是默认不可点击的（如 div, span 等），此时 click 事件会失效。</p>
<h2 id="测试代码"><a href="#测试代码" class="headerlink" title="测试代码"></a>测试代码</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">&lt;!DOCTYPE html&gt;  </div><div class="line">&lt;html&gt;  </div><div class="line">&lt;head&gt;  </div><div class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</div><div class="line">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width&quot;&gt;</div><div class="line">    &lt;title&gt;iOS click bug test&lt;/title&gt;</div><div class="line"></div><div class="line">    &lt;style&gt;</div><div class="line">        .container &#123;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        .target &#123;</div><div class="line">            display: block;</div><div class="line">            text-align: center;</div><div class="line">            margin: 100px 30px 0;</div><div class="line">            padding: 10px 0;</div><div class="line">            border: 1px solid #ccc;</div><div class="line">        &#125;</div><div class="line">    &lt;/style&gt;</div><div class="line">&lt;/head&gt;  </div><div class="line">&lt;body&gt;  </div><div class="line">    &lt;div class=&quot;container&quot;&gt;</div><div class="line">        &lt;div class=&quot;target&quot;&gt; Click Me! &lt;/div&gt;</div><div class="line">    &lt;/div&gt;</div><div class="line"></div><div class="line">    &lt;script src=&quot;//code.jquery.com/jquery-2.1.4.min.js&quot;&gt;&lt;/script&gt;</div><div class="line">    &lt;script type=&quot;text/javascript&quot;&gt;</div><div class="line">        // 或者 $(document).on(&apos;click&apos;, ....)</div><div class="line">        $(&apos;body&apos;).on(&apos;click&apos;, &apos;.target&apos;, function (e) &#123;</div><div class="line">            alert(&apos;click&apos;);</div><div class="line">        &#125;);</div><div class="line">    &lt;/script&gt;</div><div class="line">&lt;/body&gt;  </div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure>
<h2 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h2><p>解决办法有 4 种可供选择：</p>
<p>​将 click 事件直接绑定到目标元素（即 .target）上<br>将目标元素换成 <a> 或者 button 等可点击的元素<br>​将 click 事件委托到非 document 或 body 的父级元素上<br>​给目标元素加一条样式规则 cursor: pointer;<br>​推荐后两种。从解决办法来看，推测在 safari 中，不可点击的元素的点击事件不会冒泡到父级元素。通过添加 cursor: pointer 使得元素变成了可点击的了。</a></p>
<h2 id="扩展阅读"><a href="#扩展阅读" class="headerlink" title="扩展阅读"></a>扩展阅读</h2><ol>
<li><a href="https://www.quirksmode.org/blog/archives/2010/09/click_event_del.html" target="_blank" rel="external">Click event delegation on the iPhone</a></li>
<li><a href="https://developer.apple.com/library/content/documentation/AppleApplications/Reference/SafariWebContent/HandlingEvents/HandlingEvents.html#//apple_ref/doc/uid/TP40006511-SW6" target="_blank" rel="external">Making Elements Clickable</a></li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://han8gui.github.io/2017/06/05/mysql-binlog日志查看/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="怦然心动">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Han8gui' blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/05/mysql-binlog日志查看/" itemprop="url">mysql binlog日志查看</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-05T22:58:50+08:00">
                2017-06-05
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="基本说明"><a href="#基本说明" class="headerlink" title="基本说明"></a>基本说明</h2><ol>
<li><p>定义<br>binlog基本定义：二进制日志，也成为二进制日志，记录对数据发生或潜在发生更改的SQL语句，并以二进制的形式保存在磁盘中；</p>
</li>
<li><p>作用<br>可以用来查看数据库的变更历史（具体的时间点所有的SQL操作）、数据库增量备份和恢复（增量备份和基于时间点的恢复）、Mysql的复制（主主数据库的复制、主从数据库的复制）</p>
</li>
<li><p>格式<br>binlog的格式有三种，这也反应了mysql的复制技术：基于SQL语句的复制(statement-based replication, SBR)，基于行的复制(row-based replication, RBR)，混合模式复制(mixed-based replication, MBR)。相应地，binlog的格式也有三种：STATEMENT，ROW，MIXED。</p>
</li>
<li><p>日志位置<br>修改my.cnf参数文件<br>[mysqld]<br>log-bin=mysql-bin</p>
</li>
</ol>
<h2 id="语法说明"><a href="#语法说明" class="headerlink" title="语法说明"></a>语法说明</h2><ol>
<li>命令<br>binlog不能直接用文本的方式打开。<br>使用show binlog events方式可以获取当前以及指定binlog的日志，不适宜提取大量日志。<br>使用mysqlbinlog命令行提取(适宜批量提取日志)。</li>
</ol>
<ol>
<li><p>语法</p>
<p> 直接查看单个二进制日志文件：<br> mysqlbinlog filename</p>
<p> 提取指定position位置的binlog日志<br> –start-position=”120” –stop-position=”332”</p>
<p> 提取指定数据库binlog并转换字符集到UTF8<br> –database=test –set-charset=utf8</p>
<p> 指定结束时间<br> –start-datetime=’2015-01-20 09:00:00’ –stop-datetime=’2015-01-20 12:59:59’</p>
<p>  指定row格式解码<br> –base64-output=decode-rows </p>
<p> -v用于输出基于row模式的binlog日志<br> -vv为列数据类型添加注释</p>
</li>
</ol>
<h2 id="日志格式"><a href="#日志格式" class="headerlink" title="日志格式"></a>日志格式</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"># at 579744（开始位置）</div><div class="line">#150905  7:02:54（时间截） server id 2543308（产生该事件的服务id）  end_log_pos（日志的结束位置） 579815  Query（事件类型）   thread_id=21    exec_time=0     error_code=0</div><div class="line">SET TIMESTAMP=1441407774/*!*/;</div><div class="line">BEGIN</div><div class="line">执行的sql语句</div></pre></td></tr></table></figure>
<h2 id="其他说明"><a href="#其他说明" class="headerlink" title="其他说明"></a>其他说明</h2><ol>
<li>在数据出错的情况下，使用 MYSQLBINLOG 来恢复数据</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://han8gui.github.io/2017/05/30/MVC中的service层是干嘛的？/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="怦然心动">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Han8gui' blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/05/30/MVC中的service层是干嘛的？/" itemprop="url">MVC中的service层是干嘛的？</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-30T21:30:08+08:00">
                2017-05-30
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><p>mvc框架由model，view，controller组成，执行流程一般是：在controller访问model获取数据，通过view渲染页面。</p>
<p>mvc模式是web开发中的基础模式，采用的是分层设计，各层之间职责分明。然而事与愿违，当我们日积月累的基于mvc模式开发之后，会逐渐的感受到层与层之间存在粘连和职责模棱两可的地方，这就是service层出现的重要原因。</p>
<h1 id="问题是什么？"><a href="#问题是什么？" class="headerlink" title="问题是什么？"></a>问题是什么？</h1><p>问题的本质是：业务逻辑粘连了C层和M层，应该从C层&amp;M层解耦出来，成为独立的Service层。<br>在C层直接实现业务逻辑，缺点：</p>
<ol>
<li><p>不同的controller之间，无法共享通用的业务逻辑，比如：折扣计算。</p>
</li>
<li><p>业务逻辑升级，需直接在原代码上做修改兼容，导致controller代码不断膨胀复杂。</p>
</li>
</ol>
<h1 id="service层的作用："><a href="#service层的作用：" class="headerlink" title="service层的作用："></a>service层的作用：</h1><p>service是业务层，是使用一个或多个模型执行操作的方法。</p>
<ol>
<li>封装通用的业务逻辑，操作。<br> 如一些数据的检验，可以通用处理。</li>
<li>与数据层的交互。</li>
<li>其他请求：如远程服务获取数据，如第三方api等。</li>
</ol>
<h1 id="补充："><a href="#补充：" class="headerlink" title="补充："></a>补充：</h1><ol>
<li>Model和Service验证方面<br>Model校验：某些字段不能为空等数据层的校验<br>Service验证：逻辑层的校验，避免一些不合理的出现，尤其是调用多个模型</li>
<li>ci框架扩展service<br><a href="http://www.cnblogs.com/SLchuck/p/5804555.html" target="_blank" rel="external">http://www.cnblogs.com/SLchuck/p/5804555.html</a></li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://han8gui.github.io/2017/05/23/HTTP协议入门/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="怦然心动">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Han8gui' blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/05/23/HTTP协议入门/" itemprop="url">HTTP协议入门</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-23T23:13:00+08:00">
                2017-05-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="版本说明"><a href="#版本说明" class="headerlink" title="版本说明"></a>版本说明</h1><h2 id="一-HTTP-0-99版本"><a href="#一-HTTP-0-99版本" class="headerlink" title="一. HTTP 0.99版本"></a>一. HTTP 0.99版本</h2><p>命令:GET<br>用法: GET /index.html<br>响应:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;html&gt;</div><div class="line">  &lt;body&gt;Hello World&lt;/body&gt;</div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure></p>
<h2 id="二-HTTP-1-0版本"><a href="#二-HTTP-1-0版本" class="headerlink" title="二. HTTP 1.0版本"></a>二. HTTP 1.0版本</h2><ol>
<li>命令: GET、POST、HEAD</li>
<li>通用头部:主要用于传达关于消息本身的信息，而不是它所携带的内容。<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">Request URL:http://www.ruanyifeng.com/blog/2012/05/internet_protocol_suite_part_i.html</div><div class="line">Request Method:GET</div><div class="line">Status Code:200 OK</div><div class="line">Remote Address:116.251.204.42:80</div><div class="line">Referrer Policy:no-referrer-when-downgrade</div></pre></td></tr></table></figure>
</li>
</ol>
<p>请求格式:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">Accept:text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</div><div class="line">Accept-Encoding:gzip, deflate, sdch</div><div class="line">Accept-Language:zh-CN,zh;q=0.8</div><div class="line">Cache-Control:max-age=0</div><div class="line">Connection:keep-alive</div><div class="line">Cookie:_ga=GA1.2.81864988.1486909163; _gid=GA1.2.993479087.1495547947</div><div class="line">Host:www.ruanyifeng.com</div><div class="line">If-Modified-Since:Thu, 18 May 2017 00:37:52 GMT</div><div class="line">If-None-Match:&quot;3dc9a-54fc19d6cf800-gzip&quot;</div><div class="line">Referer:http://www.ruanyifeng.com/blog/2016/08/http.html</div><div class="line">Upgrade-Insecure-Requests:1</div><div class="line">User-Agent:Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.96 Safari/537.36Accept-Ranges:bytes</div><div class="line">Connection:Keep-Alive</div><div class="line">Content-Encoding:gzip</div><div class="line">Content-Length:48951</div><div class="line">Content-Type:text/html</div><div class="line">Date:Tue, 23 May 2017 14:03:26 GMT</div><div class="line">ETag:&quot;3dc9a-54fc19d6cf800-gzip&quot;</div><div class="line">Keep-Alive:timeout=5, max=100</div><div class="line">Last-Modified:Thu, 18 May 2017 00:37:52 GMT</div><div class="line">Server:Apache</div><div class="line">Vary:Accept-Encoding</div></pre></td></tr></table></figure></p>
<p>响应格式:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">Accept-Ranges:bytes</div><div class="line">Connection:Keep-Alive</div><div class="line">Content-Encoding:gzip</div><div class="line">Content-Length:48951</div><div class="line">Content-Type:text/html</div><div class="line">Date:Tue, 23 May 2017 14:03:26 GMT</div><div class="line">ETag:&quot;3dc9a-54fc19d6cf800-gzip&quot;</div><div class="line">Keep-Alive:timeout=5, max=100</div><div class="line">Last-Modified:Thu, 18 May 2017 00:37:52 GMT</div><div class="line">Server:Apache</div><div class="line">Vary:Accept-Encoding</div></pre></td></tr></table></figure></p>
<ol>
<li><p>详细说明<br>Content-Encoding：数据的压缩方法<br>Content-Type:数据格式</p>
</li>
<li><p>缺点</p>
</li>
</ol>
<blockquote>
<p>HTTP/1.0 版的主要缺点是，每个TCP连接只能发送一个请求。发送数据完毕，连接就关闭，如果还要请求其他资源，就必须再新建一个连接。</p>
</blockquote>
<p>解决方法：Connection: keep-alive</p>
<h2 id="三、-HTTP-1-1"><a href="#三、-HTTP-1-1" class="headerlink" title="三、 HTTP/1.1"></a>三、 HTTP/1.1</h2><ol>
<li>持久连接</li>
<li>管道机制</li>
<li>Content-Length 字段</li>
</ol>
<h1 id="HTTP基础"><a href="#HTTP基础" class="headerlink" title="HTTP基础"></a>HTTP基础</h1><p>一、HTTP方法<br>|HTTP方法| 描述|<br>| :——–   | —–  |<br>|GET    |从服务器向客户端发送命名资源|<br>|PUT    |将客户端的数据存储到一个命名的服务器资源中去|<br>|DELETE |从客户端删除命名资源|<br>|POST   |将客户端数据发送到一个服务器网关应用程序|<br>|HEAD   |仅发送命名资源相应中的HTTP头部|</p>
<p>二、状态码<br>|整体范围|已定义范围|分类|<br>|:–:|:–:|:–:|<br>|100-199|100-101|信息提示|<br>|200-299|200-206|成功|<br>|300-399|300-305|重定向|<br>|400-499|400-415|客户端错误|<br>|500-599|500-505|服务器错误|</p>
<p>三、网络模型<br>|模型层次| 描述|例子<br>| :——–   | —–  |<br>|HTTP    |应用层|DHCP（v6） DNS FTP Gopher HTTP（SPDY、HTTP/2） IMAP4 IRC NNTP XMPP POP3 SIP SMTP SNMP SSH TELNET RPC RTCP RTP RTSP SDP SOAP GTP STUN NTP SSDP|<br>|TCP     |传输层|TCP（T/TCP · Fast Open） UDP DCCP SCTP RSVP PPTP TLS/SSL|<br>|IP      |网络层|IP（v4·v6） ICMP（v6） IGMP IS-IS IPsec BGP RIP OSPF RARP|<br>|链路层  |数据链路层|Wi-Fi（IEEE 802.11） ARP WiMAX（IEEE 802.16） ATM DTM 令牌环 以太网 FDDI 帧中继 GPRS EV-DO HSPA HDLC PPP PPPoE L2TP ISDN SPB STP|<br>|物理网络硬件| 物理层|以太网 调制解调器 电力线通信 同步光网络 G.709 光导纤维 同轴电缆 双绞线|</p>
<p>四、从输入URL到页面加载完成的过程中都发生了什么事情</p>
<ol>
<li>浏览器查找域名的IP地址:这一步包括DNS具体的查找过程，包括：浏览器缓存-&gt;系统缓存-&gt;路由器缓存…</li>
<li>浏览器向web服务器发送一个HTTP请求;</li>
<li>服务器的永久重定向响应; </li>
<li>浏览器跟踪重定向地址; </li>
<li>服务器处理请求;</li>
<li>服务器返回一个HTTP响应; </li>
<li>浏览器显示HTML;</li>
<li>浏览器发送请求获取嵌入在HTML中的资源（如图片、音频、视频、CSS、JS等等）;</li>
<li>浏览器发送异步请求;</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/3/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/5/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">怦然心动</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">47</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">31</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/han8gui" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:han8gui@gmail.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://weibo.com/240008000" target="_blank" title="Weibo">
                      
                        <i class="fa fa-fw fa-weibo"></i>Weibo</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">怦然心动</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>








        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  
  

  

  

  

</body>
</html>
